<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
	<title>UCL VR Core</title>
	<style type="text/css">
	*{font-family:'Lato',sans-serif;}
	html,body,div,ul,li,form,h1,h2,h3,h4,h5,h6{position:relative;margin:0;padding:0;background:transparent;color:#222;list-style-type:none;}
	html{background:#252d57;}
	a,a:hover{text-decoration:none;cursor:pointer;}
	a{color:#252d57;}
	a:hover{color:#404f9c;border-bottom:1px dotted #404f9c;}
	input,input:hover,input:active{outline:none;outline:0;background:transparent;border:none;padding:2px 6px;margin:0;cursor:pointer;}
	input[type="text"],input[type="password"]{display:block;background-color:#c2ccff;border-radius:10px;height:28px;width:300px;text-align:center;font-size:18px;}
	input[type="submit"]{display:block;border:1px solid #252d57;border-radius:10px;height:28px;width:110px;text-align:center;font-size:18px;margin:0 0 25px 0;}
	#wrapper{max-width:450px;background:#fff;margin:40px auto;padding:15px 35px;border-radius:15px;}
	#headerlinks li{float:left;padding:0 25px 0 0;}
	#headerlinks li a{line-height:34px;font-size:16px;padding:0 0 6px 0;}
	#headerlinks{overflow:auto;}
	h2{margin:25px 0 10px 0;display:block;border-bottom:1px solid #252d57;padding:0 0 8px 0;}
	form{display:block;border-bottom:1px solid #252d57;}
	label{font-size:12px;line-height:24px;margin:0 0 15px 0;display:block;}
	#resultframe{background:#c2ccff;border:1px solid #252d57;padding:6px 20px;margin:15px 0;}
	#targetframe{overflow:auto;border-bottom:1px solid #252d57;}
	#target,#upload,#convert,#hideframe{height:1px;width:1px;position:absolute;left:-10000px;}
	.status_filename,.status_status{float:left;display:block;font-size:12px;line-height:18px;margin:0 0 8px 0;}
	.status_filename{clear:left;width:300px;}
	.status_status{}
	</style>
</head>
<body>

<div id="wrapper">

<h1>VR Core</h1>

<div id="resultframe">
	no result.
</div>

<ul id="headerlinks">
	<li><a class="act" href="javascript:s('login');">Login</a></li>
	<li><a class="act" href="javascript:s('register');">Register</a></li>
	<li><a class="act" href="javascript:convertstart();">Convert New Video</a></li>
	<li><a class="act" href="javascript:checkstatus();">Check Status</a></li>
</ul>

<form id="login" method="post" action="/uclvr/index.html" onsubmit="loginprocess();return false;">
	<h2>Login</h2>
	<label>Username<input type="text" name="uname" id="uname1"></label>
	<label>Password<input type="password" name="password" id="password"></label>
	<input type="submit" value="Log In">
</form>

<form id="register" method="post" action="/uclvr/index.html" onsubmit="registerprocess();return false;">
	<h2>Register</h2>
	<label>Username<input type="text" name="uname" id="uname2"></label>
	<label>Email<input type="text" name="email" id="email"></label>
	<label>Password<input type="password" name="password1" id="password1"></label>
	<label>Repeat Password<input type="password" name="password2" id="password2"></label>
	<input type="submit" value="Finish">
</form>

<form id="convert" method="post" target="hideframe" action="http://uclvrcore1.cloudapp.net/uclvr/upload/" enctype="multipart/form-data">
	<input type="file" name="target" id="target" onchange="$('#upload').click();">
	<input type="submit" id="upload" value="Upload">
</form>

<span id="authstatus" class="h">no</span>
<div id="targetframe" class="h"></div>
<iframe id="hideframe" name="hideframe" onload="hideframechange();"></iframe>

</div>

<script>
jQuery.get("/uclvr/auth/?uname=azureuser&password=UCLvrcore",function(data){if(data.indexOf("success")){$("#authstatus").html("yes");}});
var i;

$(document).ready(function(){
	$("form").hide();
	$(".h").hide();
	$("#resultframe").hide();
});

function h(){
	$("form").hide("slow");
	$(".h").hide();
}

function s(n){
	h();
	$("#"+n).show("slow");
}

function resultshow(){
	h();
	$("#resultframe").show("slow").delay(3000).hide("slow");
}

function loginprocess(){
	if($("#uname1").val().length>0){
		$("#resultframe").html("Login successful as "+$("#uname1").val()+".");
	}else{
		$("#resultframe").html("Login failed.");
	}
	resultshow();
}

function registerprocess(){
	if($("#uname2").val().length>0){
		$("#resultframe").html("Registration has been processed for "+$("#uname2").val()+".");
	}else{
		$("#resultframe").html("Registration failed.");
	}
	resultshow();
}

function downloading(){
	$("#resultframe").html("Your file is now downloading.");
	resultshow();
}

function convertstart(){
	h();
	s("convert");
	$("#target").click();
}

function hideframechange(){
	if($("#hideframe").contents().length>0){
		checkstatus();
	}
}

function checkstatus(){
	h();
	jQuery.get("/uclvr/status",function(r){
		var ra=r.split("\n");ra.splice(0,3);
		ra.sort();
		var rr='<h2>Status</h2>';
		for(i=0;i<ra.length;++i){
			if(ra[i].length>1){
				var rb=ra[i].split(" ");
				rr+='<span class="status_filename">';
				if(rb[1]=="reconstructed"){
					rr+='<a href="/uclvr/download?name='+encodeURIComponent(rb[0])+'" onclick="downloading();">'+rb[0]+"</a>";
				}else{
					rr+=rb[0];				
				}
				rr+='</span><span class="status_status">'+rb[1]+'</span>';
			}
		}
		$("#targetframe").html(rr);
		$("#targetframe").show("slow");
	});
}

</script>
</body>
</html>